"use strict";function ownKeys(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(s),!0).forEach((function(t){_defineProperty(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function _defineProperty(e,t,s){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}const GFEmailVerificationState={codeSent:[],showCodeSentMessage:!1,cookiesCleared:!1};class GFEmailVerification{constructor(e,t){var s,i;_defineProperty(this,"clearEmailError",(()=>{const e=this.emailFieldContainer.querySelector(this.selectors.validationMessage);e&&(e.remove(),this.emailFieldContainer.classList.remove(this.classNames.gFieldError))})),_defineProperty(this,"showEmailError",(e=>{let t=this.emailFieldContainer.querySelector(this.selectors.validationMessage);t||(t=document.createElement("div"),t.classList.add("gfield_description","validation_message","gfield_validation_message"),t.setAttribute("id",`validation_message_${this.formId}_${this.emailFieldData.id}`),this.emailFieldContainer.appendChild(t)),this.emailFieldContainer.classList.add(this.classNames.gFieldError),t.innerText=e})),_defineProperty(this,"showFatalError",(e=>{const t=document.createElement("div");t.classList.add(this.classNames.fatalErrorMessage);const s=document.createElement("span");s.classList.add("gform-icon","gform-icon--info"),t.innerText=e,t.appendChild(s),this.formFooter.appendChild(t)})),_defineProperty(this,"clearFatalError",(()=>{const e=this.formFooter.querySelector(this.selectors.fatalErrorMessage);e&&e.remove()})),_defineProperty(this,"ajaxRequest",(async(e,t)=>{const{ajaxUrl:s,nonce:i}=this.localizedData,o=`rfs_gf_email_verification_${t}`,a=await fetch(`${s}`,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:new URLSearchParams(_objectSpread({nonce:i,action:o},e))});return await a.json()})),this.formId=e,this.localizedData=null===(s=window)||void 0===s?void 0:s[`RFS_GF_EMAIL_VERIFICATION_FORM_${this.formId}`],this.localizedData&&(this.form=document.querySelector(`.gform_wrapper form#gform_${e}.is-vc-form`),this.form&&(this.currentPage=parseFloat(t),this.formInfo=this.localizedData.formInfo,this.state=GFEmailVerificationState,null!==(i=this.formInfo)&&void 0!==i&&i.id&&(this.formInfo.code_sent&&(this.state.codeSent.push(this.formId),this.state.showCodeSentMessage=!0),this.emailFieldData=this.formInfo.fields.email,this.codeFieldData=this.formInfo.fields["email-verification-code"],this.selectors={page:".gform_page",gField:".gfield",sendButton:".js-gform-vc-button",sendButtonLabel:".gform_vc_button_label",nextButton:".gform_next_button",validationMessage:".validation_message",emailField:`input[name="input_${this.emailFieldData.id}"]`,codeField:`input[name="input_${this.codeFieldData.id}"]`,codeSentMessage:".gform-vc-message",formFooter:".gform_footer",formPageFooter:".gform_page_footer",fatalErrorMessage:".gform-fatal-error"},this.classNames={show:"show",hide:"hide",loading:"is-loading",locked:"is-locked",codeSentMessage:"gform-vc-message",gFieldError:"gfield_error",fatalErrorMessage:"gform-fatal-error",ajaxForm:"is-ajax-form"},this.init())))}init(){!this.state.cookiesCleared&&this.form.classList.contains(this.classNames.ajaxForm)?this.ajaxRequest({},"clear_cookies").then((e=>{const{success:t,data:s}=e;t?this.addonInit():null!=s&&s.fatal&&this.addonInit(s.fatal),this.state.cookiesCleared=!0})):this.addonInit()}addonInit(e=!1){this.form.classList.add(this.classNames.show),this.setDOM(),this.emailFieldData.page===this.codeFieldData.page&&(this.setSendButton(),this.displayCodeSentMessage(),e&&this.showFatalError(e[98]))}setDOM(){this.page=this.form.querySelectorAll(this.selectors.page),this.page.length?this.container=this.form.querySelector(`#gform_page_${this.formId}_${this.currentPage}`):this.container=this.form,this.container&&(this.page.length?this.formFooter=this.container.querySelector(this.selectors.formPageFooter):this.formFooter=this.container.querySelector(this.selectors.formFooter),this.hiddenField=this.form.querySelector('input[name="gform_vc"]'),this.codeField=this.form.querySelector(this.selectors.codeField),this.emailField=this.form.querySelector(this.selectors.emailField),this.emailField&&this.codeField&&this.hiddenField&&(this.hiddenField.value="evc",this.emailFieldContainer=this.emailField.closest(this.selectors.gField),this.codeFieldContainer=this.codeField.closest(this.selectors.gField),this.sendButton=this.container.querySelector(this.selectors.sendButton),this.nextButton=this.container.querySelector(this.selectors.nextButton)))}setFormRules(){const{display:e,behaviour:t}=this.sendButton.dataset;this.sendButtonDisplay=e,this.sendButtonBehaviour=t,this.fieldsSamePage=this.emailFieldData.page===this.codeFieldData.page,this.isEmailFieldPage=this.emailFieldData.page===this.currentPage,this.isCodeFieldPage=this.codeFieldData.page===this.currentPage,this.emailFieldOnCurrentPage=this.container.querySelector(this.selectors.emailField),this.codeFieldOnCurrentPage=this.container.querySelector(this.selectors.codeField),this.isSendCodeOnNextPage="next-page"===this.sendButtonBehaviour&&"email-page"===this.sendButtonDisplay&&this.formInfo.pagination,this.showEmailCodeSentMessage="email-page"===this.sendButtonDisplay&&!this.fieldsSamePage&&this.isEmailFieldPage,this.showSendButton="email-page"===this.sendButtonDisplay?this.codeFieldOnCurrentPage||this.emailFieldOnCurrentPage:this.codeFieldOnCurrentPage,this.codeSentOnNext=this.isSendCodeOnNextPage&&this.currentPage===this.emailFieldData.page+1,this.state.codeSent.includes(this.formId)&&(this.showSendButton=!1)}setSendButton(){this.sendButton&&(this.setFormRules(),this.showSendButton?(this.sendButtonEventHandler(),this.sendButton.classList.add(this.classNames.show)):this.sendButton.remove())}sendButtonEventHandler(){this.sendButton.addEventListener("click",(()=>{this.isLoading||(this.lockButtons(),this.clearEmailError(),this.clearFatalError(),this.codeSentMessage&&this.codeSentMessage.remove(),this.ajaxRequest({formId:this.formId,email:this.emailField.value,hiddenField:this.hiddenField.value},"send_verification_code").then((e=>{const{success:t,data:s}=e;t?(this.state.codeSent.push(this.formId),this.state.showCodeSentMessage=!0,this.isLoading=!1,this.unlockButtons(),this.displayCodeSentMessage(),this.sendButton.remove()):null!=s&&s.email?(this.isLoading=!1,this.unlockButtons(),this.showEmailError(s.email)):null!=s&&s.fatal&&(this.isLoading=!1,this.unlockButtons(),this.showFatalError(s.fatal[99]))})),this.isLoading=!0)}))}lockButtons(){this.sendButton.classList.add(this.classNames.loading),this.sendButton.parentElement.classList.add(this.classNames.locked),this.sendButton.parentElement.querySelectorAll(".button").forEach((e=>e.setAttribute("disabled",!0)))}unlockButtons(){this.sendButton.classList.remove(this.classNames.loading),this.sendButton.parentElement.classList.remove(this.classNames.locked),this.sendButton.parentElement.querySelectorAll(".button").forEach((e=>e.removeAttribute("disabled")))}displayCodeSentMessage(){if(!this.state.showCodeSentMessage)return;let e=this.codeFieldContainer;if(this.showEmailCodeSentMessage&&(e=this.emailFieldContainer),e&&(this.codeSentMessage=e.querySelector(this.selectors.codeSentMessage),!this.codeSentMessage)){this.codeSentMessage=document.createElement("p"),this.codeSentMessage.classList.add(this.classNames.codeSentMessage);const t=document.createElement("span");t.classList.add("gform-icon","gform-icon--info"),this.codeSentMessage.innerText=this.showEmailCodeSentMessage?this.formInfo.settings["code-sent-message-email-field"]:this.formInfo.settings["code-sent-message"],this.codeSentMessage.appendChild(t),e.appendChild(this.codeSentMessage)}}}jQuery(document).on("gform_post_render",((e,t,s)=>{new GFEmailVerification(t,s)}));